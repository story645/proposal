\documentclass[../main.tex]{subfiles}
\begin{document}

%% convention is base space \times fiber bundle
%% change B to K
\section{Notation \& Definitions}
%% intro placeholder of eq in intro
%% use let or where before you introduce symbols
%% more notations w/ general words 
%% tone down - mathcal A, mathcal E, and mathcal H - space, will formalized in this section 
%% give the why of the math after every mention of why
In this section we introduce a mathematical description of the visualization pipeline where artist $A$ functions transform data of type $\Gamma(E)$ to an intermediate representation in prerendered display space of type $\Gamma(H)$:

\begin{equation}
    \label{eq:artist}
    A: \Gamma(E) \rightarrow \Gamma(H)
\end{equation}

\begin{itemize}
\item $A$ is the function that converts an instance of data $\Gamma(E)$ to an instance of a visual representation $\Gamma(H)$ 
\item $E$ is a locally trivial fiber bundle over $K$ representing data space.
\item $H$ is a fiber bundle over $S$ representing visual space
\item $K$ and $S$ is a triangulizable topological space or CW complex encoding the connectivity of the points in $E$
\end{itemize}
All the fiber bundles mentioned in this work is assumed to be locally trivial \cite{rowlandFiberBundle,FiberBundle2020}. 

\subsection{Data Fiber Bundles}
\begin{figure}[H]
    \label{fig:data_fiber_bundle}
    \includegraphics[width=.2\linewidth]{figures/sections/math/fiberbundle.png}
    \caption{write up some words here}
\end{figure}

As proposed by Butler \cite{butlerVectorBundleClassesForm1992,butlerVisualizationModelBased1989}, we model data as a fiber bundle (E, K, $\pi$, F) with $\pi: E \rightarrow K$ where $K$ which can be thought of as a set of keys $k$. A section $\tau:K \rightarrow E$ is an instance of the data that lies in $E$ and is discussed in section~\ref{sec:data_fiber}. 


We provide a brief description of fiber bundles because we model data, visual transformations, and a prerendered visual graphic as fiber bundles.  Fiber bundles are product spaces of toplological spaces, which are a set of points with a set of neighborhoods for each point\cite{FiberBundle2020, rowlandFiberBundle}. A fiber bundle is a structure $(E, B, \pi, F)$  consisting of topological total space $E$, base space $K$, fiber space $F$ and the map from total space to base space:

\begin{equation}
    \label{eq:fiber_bundle}
    \begin{tikzcd}
        F \arrow[r, hook] & E \arrow[r, "\pi"] & B
    \end{tikzcd}
\end{equation}

where there is a bijection from $F$ to every fiber $F_b$ over point $b \in B$ in $E$ and the function $\pi: E \rightarrow B$ is the map into the $B$ quotient space of $E$. By defintion of a fiber bundle, $\pi$ is always a mapping from total space to base space, independent of the points $p \in E$, and therefore we call this mapping $\pi$ for all the fiber bundles in the model. 

\subsubsection{Base space}
\begin{figure}[H]
    \label{fig:base_space}
    \includegraphics[width=0.4\linewidth]{figures/sections/math/k_qspace.png}
    %%include second figure where fiber goes otherway
\end{figure}

%%% add in motivation - encodes the connectiveity of the points, choice of split is intrinsinc to how we want to view the data

$B$ is the quotient space of $E$, meaning it is the set of equivalence classes of elements $p$ in $E$ defined via the map $\pi: E \rightarrow B$ that sends each $p \in E$ to its equivalence class in $[p] \in B$ \cite{QuotientSpaceTopology2020,QuotientSpaceTopology2020}.

As shown in figure~\ref{fig:kquote}, the fibers $F$ divide $E$ into smaller spaces consisisting of $F$ and an open set neighborhood \cite{FiberBundle2020, rowlandFiberBundle}  around $F$.
%%so why topology? 
\paragraph{Example}
%%% pull up data structures like discrete, continous, etc w/ base space 
%%% little drawing dots, line, plane, cube

\begin{figure}[ht]
    \includegraphics[width=0.2\linewidth]{figures/sections/math/temp_1k.png}
    %% add box around neighboring P and Map
    \label{fig:k_data}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.2\linewidth]{figures/sections/math/temp_2k.png}
\end{figure}

in figure~\ref{fig:k_data}, temperature is the only one data field in $r$ but the $K$ base spaces are different. subfig[1] is a timeseries, so the temperature in $r$ at time $t$ is dependent on the temperature in $r_{t-1}$ and the temperature in $r_{t+1}$ is dependent on  $r_t$; this connectivity is expressed as a one dimensional $K$ where $K$ is the number line. In the case of the map, every temperature in $r$ is dependent on its nearest neighbors on the plane, and one way to express this is by encoding $K$ as a plane. $K$ does not know the time or latitude or longitude of the point as those are metadata variables describing the $k$ rather than the value of $k$. The mapping $\tau: K \rightarrow E$ provides the binding between the key $k \in K$ and the value $r$ in $E$ \cite{munznerChDataAbstraction}.



\subsubsection{Fiber}
%% pull fiber stuff up here? what is it? why? fiber as cartesian product of sets
%% actual values are in the fiber 
%% gonna view spaces as simple piece put together 
%% Our fibers are cross products of (column name, domain) as described by Spivak's \cite{spivakSIMPLICIALDATABASES}. 


\begin{equation}
    \label{eq:fiber_local_trivial}
    \begin{tikzcd}
        \pi^{-1}(U) \arrow[r, "\varphi"] \arrow[d, "\pi"'] & U \times F \arrow[ld, "\mathrm{proj}_U"] \\
        U                                                  &                                         
    \end{tikzcd}
\end{equation}
such that $\varphi: \pi^{-1}(U) \rightarrow U \times F$ is a homeomorphism where $\pi$ and $\mathrm{proj}_U$ both map to $U$ and the fiber over $k$

%% rewrite this section - what are the goals here and why should we care? 
%% devoid of any context

$F_b = \pi^{-1}({b \in B}) $ is homomorphic to the fiber $F$.
%% add a sentence for why we care
%% fibers are cartesian products of these typles sets (name, domain, monoidal action) 

%%the break out more about how fibers are cross products and what that means and how that's the structure - pull the monoids definitions here 

\paragraph{Example}
%% stevens scales are examples of this 
%% one ecample of F1 is (names, strings, concat), (ordinal, Z,  ordering), () 



\subsubsection{Section}
%% add context
The section $f$ is the mapping from base space to total space $f: B\rightarrow E$ 
\begin{equation}
    \label{eq:section}
    \begin{tikzcd}
        F \arrow[r, hook] & E \arrow[d, "\pi"']           \\
        & B \arrow[u, "f"', bend right]
    \end{tikzcd}
\end{equation}

such that $f$ is the right inverse of $\pi$
\begin{equation}
    \label{eq:section_domain}
    \pi(f(b)) = b \text{ for all } b \in B 
\end{equation}

In a locally trivial fiber bundle, $E = B \times F$ \cite{rowlandFiberBundle,FiberBundle2020}:
\begin{equation}
    \label{eq:section_return}
f(b) = (b, g(b))
\end{equation}

where the domain of $g(b)$ is $F_b$ and returns a point $p$ in $F_b$. The space of all possible sections $f$ of $E$ is $\Gamma(E)$. All sections $f \in \Gamma(E)$ have the same fibers $F$ and connectivity $B$. 
\paragraph{Example}
%%talk about table and all that jazz

For each field $c \in C$, the record function $r: C \rightarrow U_{\sigma}$ returns an object of type $\sigma(c) \in DT$. The set of all records $\Gamma(\sigma)$ is the set of all sections on $U_\sigma$. Spivak defines the $\tau$ mapping from an index of databases $K$ to records $\Gamma(\sigma)$ as $\tau: K \rightarrow \Gamma(\sigma)$. This is equivalent to $\tau: k \rightarrow E$ since $F = \Gamma(\sigma)$ and $F$ is the embedding in $E$ on which the records $r$ lie.
 
\subsubsection{Example}
\begin{figure}[H]
    \includegraphics[width=0.2\linewidth]{figures/sections/math/temp_2f.png}
    \label{fig:}
\end{figure}
\begin{figure}[H]
    \includegraphics[width=0.2\linewidth]{figures/sections/math/temp_3f.png}
\end{figure}


%% pull out measurement
The fiber in figure~\ref{fig:temp} is the space of possible temperature values in degrees celsius, such that $F=[temp_{min}, temp_{max}]$ and is named \textrm{Temp}. In figure~\ref{fig:temp_time} \textrm{time} is encoded as a second dimension. This means that the set of possible values $F$ with $C=\{\textrm{Temp}, \textrm{Time}\}$:

\begin{equation}
F = [temp_{min}, temp_{max}] \times [time_{min}, time_{max}]
\end{equation}

and the function $\tau$ that retrieves records from $F$ is

\begin{align}
\tau(k) =(k, (r: \textrm{Temp}\rightarrow &temp, r: \textrm{Time}\rightarrow time))\\
&temp \in [temp_{min}, temp_{max}], time \in [time_{min}, time_{max}])
\end{align}

Since $\tau(k)=(k, r)$, $temp$ is bound to a named data field and $sigma$ binds $temp$ to a temperature data type. 

\subsubsection{Sheaf and Stalk}
%% add motivation - zoom, subsection, streaming, also for realizing visualization, restricting to that piece - need to know near point w/o 
As described in equation~\ref{eq:local_trivial}, there is a local space $U \subset B$ around every $b$. The inclusion map $\iota: U \rightarrow B$ can be pulled back such that $\iota^{*}E$ is the space of $E$ restricted over $U$. 
\begin{equation}
    \label{eq:sheaf}
    \begin{tikzcd}
        \iota^*E \arrow[d, "\pi"']           & E \arrow[d, "\pi"'] \arrow[l, "\iota^*"']         \\
        U \arrow[u, "\iota^*f"', bend right] & B \arrow[u, "f"', bend right] \arrow[l, "\iota"']
        \end{tikzcd}
\end{equation}

The localized section of fibers $\iota^*f: U \rightarrow \iota^*E$ is the sheaf $\mathcal{O}(E)$ with germ of $\xi^*f$ which is the localized section. The neighborhood of points the sheaf lies over is the stalk $\mathcal{F}_b$ \cite{StalkSheaf2019,spanier1989algebraic} which is a ...$\dots$
. Restricting the artist to the sheaf means the artist knows the data in $F$ and also has access to derivatives of the data. This property is useful for some visual transformations. 
%% gives all direvatives but we need the jet which is Add stuff about jets

\subsubsection{Triangulization}
%%drop down to after the fiber section
The base space $K$ is a representation of the connectivity of the data, specifically whether the points in $E$ are discrete or sampled from a continous space. The same dataset can be expressed with different $K$. 

In our draft implementation of the data as fiber bundle model, we represent $K$ as a simplacial complex. 

\begin{figure}[H]
    \label{fig:simplex}
    \includegraphics{figures/sections/math/simplex.png}
    \caption{Simplices encode the connectivity of the data, from fully disconnected (0 simplex) observations to all observations are connected to at least 3 other observations. Higher order simplicies are outside the scope of this paper.}
\end{figure}

%% k is a triangularizable topological space 
One way to represent the topological space K is as a set composed of simplices, such as those shown in figure~\ref{fig:simplex}. Simplices are a way of encoding the connectivity of each observation ($\sigma(k)$) to another: %%formula for simplacial complexes/simplacial sets

\paragraph{Example}
chopping up a torus maybe? talk about how that gets unpacked into triangles and then into vertices


\subsection{Prerender Space}
\label{sec:display}


We model the prerender space on which lives on ideal version of the visulaization as a fiber bundle (H, S, $\pi$, D). $H$ is the predisplay space, with a fiber $D$ dependent on the target physical display and a base space of $S$. 

\subsubsection{Base space}
%%pull up to the very top that dim(k) < screen space, need to thicken therefore S
$K$ can be considered a subspace of the screen base space $S$ such that $\xi: S \rightarrow K$ is a deformation retraction \cite{RetractionTopology2020}
\begin{equation}
    \begin{tikzcd}
        E \arrow[d, "\pi"'] & H \arrow[d, "\pi"'] \\
        K                   & S \arrow[l, "\xi"']
        \end{tikzcd}
\end{equation}

that goes from a region $s \in S_{k}$ to its associated point $k$, such that when $\xi(s) = k$, $\xi^*\tau(s) = \tau(k)$. 

\subsubsection{Fiber and Section}
A section $\rho: S \rightarrow H$ is a mapping from a region $s$ on a mathematical encoding of the image to a region $xy$ on the screen that the renderer then maps to visual space as defined in D.

\paragraph{Example}
For a physical screen display, we can consider a predisplay space that is a trivial fiber bundle $H=\mathbb{R}^{5}\times S$ such that $\rho$ is
\begin{equation}
    \rho(s)  = [x(s), y(s), r(s), g(s), b(s)]
    \label{eq:rho}
\end{equation}

To draw an image, a region, $H$ is inverse mapped into a region $s \in S$ where
\begin{equation}
s = \rho^{-1}_{\tiny{XY}}(xy)
\end{equation}
such that the rest of the fields in $\mathbb{R}^{7}$ are then integrated over $s$ to yield the remaining fields:
\begin{align}
    r &= \iint\limits_s \rho_{\tiny{R}}(s)ds^{2}\\
    g &= \iint\limits_s \rho_{\tiny{G}}(s)ds^{2}\\
    b &= \iint\limits_s \rho_{\tiny{B}}(s)ds^{2}
\end{align}

Here we assume a single opaque 2D image such that the $z$ and $alpha$ fields can be omitted. To support overplotting and transparency, we consider $D=R^{7}$
%%H can be other spaces  

\subsubsection{{Example}}
\begin{figure}[H]
    \includegraphics[width=.4\linewidth]{figures/sections/math/render.png}
    \caption{}
    \label{fig:render}
\end{figure}

As illustrated in figure~\ref{fig:render}, words.

\subsection{Artist}
%%introduce O(E) up in previous section, then refer back to that section 

In this section we will define the artist as a mapping from a sheaf $\mathcal{O}(E)$  to $\mathcal{O}(H)$. 
\begin{equation}
    A: \mathcal{O}(E) \rightarrow \mathcal{O}(H)
\end{equation}

The artist decomposes to mapping data to visual $\nu:E\rightarrow V$, then  compositing $V$ pulled back along $\xi$ to $\xi^*V$ to a visual mark in prerender space $Q:\xi^*V\rightarrow H$. 

\begin{equation}
    \label{eq:artist}
    \begin{tikzcd}
        E \arrow[r, "\nu"] \arrow[rd, "\pi"'] & V \arrow[d, "\pi"] & \xi^*V \arrow[r, "Q"] \arrow[d, "\xi^*\pi"'] \arrow[l, "\xi^*"'] & H \arrow[ld, "\pi"] \\
                                              & K                  & S \arrow[l, "\xi"']                                              &                    
        \end{tikzcd}
\end{equation}
%%map backwords via pullback can copy values over k over and over to corresponding S_k

The visual fiber bundle ($V$, $K$, $\pi$, $P$) has section $\mu: V \rightarrow K$ that resolves to a visual variable \cite{bertinIIPropertiesGraphic2011,munznerMarksChannels} in fiber $P$. The visual transformer $\nu$ is a set of functions each targeting a different $\mu$
\begin{equation}
    \label{eq:nu_expanded}
    \{\nu_{0}, \ldots, \nu_{n}\}: \{\tau_{0}, \ldots, \tau_{n}\} \mapsto \{\mu_{0}, \ldots, \mu_{n}\}
\end{equation}

where $\mu_{i}$ are the visual parameters in the assembly function $Q(\mu_{0}, \ldots, \mu_{n})(s) = \rho(s)$. 


\subsubsection {Example: Matplotlib Visual Fiber}
For example, for Matplotlib \cite{hunterMatplotlib2DGraphics2007}, some of the possible types in $P$ are:
\begin{table}[ht]
    \label{tab:mpl_visual_variable_fiber}
    \renewcommand{\arraystretch}{2}
    \begin{tabulary}{\textwidth}{|l|L|l|}\hline
     $\bm{\nu_{i}}$                      & $\bm{\mu_{i}}$                                                            & $\bm{codomain(\nu_{i})}$  \\ \hline                                              
    position                    & x, y, z, theta, r                                                          & $\mathbb{R}$   \\ \hline
    size                        & linewidth, markersize                                            & $\mathbb{R}^{+}$   \\ \hline
    shape                       & markerstyle                                                      & $\{f_{0}, \ldots, f_{n}\}$ \\ \hline
    color                       & color, facecolor, markerfacecolor, edgecolor  & $\mathbb{R}^{4}$ \\ \hline
    \multirow{2}{*}{texture}    & hatch                                                            & $\mathbb{N}^{10}$\\\cline{2-3}
                                & linestyle                                                        & $\{f_{0}, \ldots, f_{n}\} \times (\mathbb{R}, \mathbb{R^+}^{n, n\%2=0})$ \\ \hline              
    \end{tabulary}
\end{table}
%%needs context, pulling monoids up gives it
\subsubsection{Visual Channels}
$\nu: E \rightarrow V$ is an equivariant map such that there is a homomorphism from left monoid actions on $E_{i}$ to left monoid actions on $V_{i}$ where $i$ identifies a field in the fiber. $E_i$ and $V_{i}$ each contain a set of values as defined in $F$ and $P$ respectively. A validly constructed $\nu$ is one where the  diagram 
\begin{equation}
    \label{eq:nu_categorical}
\begin{tikzcd}
    E_i \arrow[r] \arrow[r, "\nu_i"] \arrow[d, "m_e"'] & V_i \arrow[d, "m_v"] \\
    E_i \arrow[r, "\nu_i"]                           & V_i               
\end{tikzcd}
\end{equation}
commutes such that $\nu_i(m_e(E_i)) = m_v(\nu_i(E_i))$.

\paragraph{Definition}
A monoid\cite{Monoid2021} $M$ is a set that is closed under an associative binary operator $\ast$ and has an identity element $e\in M$ such that $e\ast a= a \ast e = a$ for all $a \in M$.  A left monoid action \cite{SemigroupAction2021,ActionNLab} of $M$ is a set $X$ with an action $\bullet$ with the properties:
\begin{description}
    \item[closure] $\bullet: M\times X \rightarrow X$,
    \item[associativity] $\text{for all } m,t \in M \text{ and } x\in X, m\bullet(t\bullet x) = (m\bullet t) \bullet x$
    \item[identity] $\text{for all } x\in X, e\in M,  e\bullet x = x$ 
\end{description} 

\paragraph{Example: Partial Order}
To preserve ordering of elements in $E_i$, $\nu$ must be a monotonic function such that given $e_1, e_2 \in E_{i}$
\begin{equation}
\text{ if } e_1 \leq e_2 \text{ then } \nu(e_1) \leq \nu(e_2)
\end{equation}

\paragraph{Example: Translation}
\textbf{fairly certain I lost the thread here}
According to Stevens, interval data is a set with general linear group actions \cite{stevensTheoryScalesMeasurement1946,leaFormalizationMeasurementScale}. Position is a visual variable that can support translation \cite{bertinIIPropertiesGraphic2011,krygierMakingMapsVisual2005,munznerMarksChannels}. 
\begin{equation}
\nu(x + c) = \nu(x) + \nu(c)
\end{equation}


\paragraph{Example: Invalid $\nu$}
Given a transform $t(x) = x+2$, we construct a $\nu$ that always takes data to .5: 
\begin{equation}
    \label{eq:nu_equation_bad}
    \begin{tikzcd}
        E_1 \arrow[r] \arrow[r, "\lambda:e\mapsto.5"] \arrow[d, "2e"'] & V_i \arrow[d, "2v"] \\
        E_1 \arrow[r, "\lambda"]                                        & V_1                 
    \end{tikzcd}
\end{equation}

This $\nu$ is invalid because the graph does not commute for $t$:
\begin{align}
    \nu(t(e)) & \overset{?}{=} t(\nu(e))\\
    .5 & \overset{?}{=} t(.5)\\
    .5 & \neq 2*.5
\end{align}

To consutruct a valid $\nu$, the diagram must commute for all monoid actions on the sets $E_i, V_i$.


\subsubsection{Assembling Marks}
\begin{figure}[H]
    \includegraphics[width=0.4\linewidth]{figures/sections/math/path_of_q}
    \label{fig:q}
    \caption{The $\nu$ functions convert data $E$ to visual $V$. $Q$ assembles the different types of visual parameters $V_{i}$ into a graphic in $H$. $Q\circ\mu(\xi^{-1}J)$ forms a visual mark by applying $Q$ to a region mapped to connected components $J \subset K$.}  
\end{figure}

The assembly function $Q: \Gamma(V) \rightarrow \Gamma(H)$ composites the visual variables in $V$ into an element in $H$. Given a monoid action on a set in $V$, there should be a monoid action on the corresponding $Q(\Gamma(V))$. While $\Gamma(V)$ holds for all cases, we can specialize to the bundle $V$ or the sheaf $\mathcal(V)$ depending on the specific visualization. 

\paragraph{Proposition}
If $\forall g \in M$ and $\forall x_1, x_2 \in \Gamma(V)$ then  $Q(x_1) = Q(x_2) \\implies Q(g\circ x_1) = Q(g\circ x_2)$; therefore we can define a group action on $Q(\Gamma(V))=Y$ as $g \circ y = y'$ where $y' = Q(g\circ x)$ with $x \in f^{-1}(y)$ 


For each region $s$ in the display space $H$, the mark  \cite{bertinIIPropertiesGraphic2011,carpendaleVisualRepresentationSemiology} it belongs to can be found by mapping $s$ back to $K$ via the lookup on $S$ then taking $\xi(s)$ back to a point on $k \in K$ which lies on the path connected component $J \subset K$. 

%% defined J_{k} first, then pull down to here, then can do \rho S_j
\begin{equation}
    \begin{tikzcd}
        H \arrow[r, shift left] & S \arrow[l, "\rho(\xi^{-1}(J))", shift left] \arrow[rr, "\xi(s)", shift left] &  & J_{k} =  \{j \in K \text{ s. t. } \exists \gamma \text{ s.t. } \gamma(0)=k \text{ and }\gamma(1)=j\} \arrow[ll, "\xi^{-1}(J)", shift left]
    \end{tikzcd}
    \label{eq:mark}
\end{equation}
where the path\cite{ConnectedSpace2020}  $\gamma$ from $k$ to $j$ is a continous function from the interval [0,1]. To get back to the display space $H$ from $J$, the inverse image of $J \in S, \xi^{-1}(J)$ is pushed back to $S$, and then $\rho(\xi^{-1}(J))$ maps it into $R^{7}$ such that $Q\circ\xi^*\mu(\xi^{-1}(J))$ generates a graphical mark.

\subsubsection{Visual Idioms: Equivalance class of artists}
n $O(E)$ of the same type, they output the same type of prerender $O(H)$:


Natural transformation + composition is partial ordering? Back and forth is equivalent 
\end{document}